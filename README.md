# Installation
***
After you've done basic instalation, mounted the filesystem and logged on, open the `/etc/nixos/configuration.nix` and add the following to `environment.systemPackages`:
```nix
environment.systemPackages = with pkgs; {
  git
  vim # Optional
}
```
Then rebuild your system with `sudo nixos-rebuild switch`

After rebuild, copy this repository via
```bash
git clone https://github.com/necodrre/nix-config.git /home/$USER/
```
and enter the directory.
```bash
cd /home/$USER/nix-config
```

## NixOS Configuration
***
Create a new folder in `./hosts` named by your host (machine):
```bash
mkdir ./hosts/<host-name>
```
Then copy all the files from `./hosts/T460` into your new directory
```bash
cp -r ./hosts/T460 ./hosts/<host-name>
```

Replace `hardware-configuration.nix` with one generated by your nixos installation.
```
sudo mv /etc/nixos/hardware-configuration.nix ./hosts/<host-name>/
```

Comment (or simply delete) everything from `hardware.graphics = {` to `services.xserver.videoDriver = [ "modesetting" ]` in `./hosts/<host-name>/configuration.nix`. 
> For more reference about setting up 3D graphics (if needed), visit [official wiki page](https://wiki.nixos.org/wiki/Graphics).

If you're not using laptop, but use PC, then comment the following line in `./nixos/modules/default.nix` since you won't need it:
```nix
...
  ./power-management.nix
...
```

Delete all the files located at `/etc/nixos` and replace them with a symlink to `./hosts/<host-name>/configuration.nix`.
```bash
sudo rm -r /etc/nixos/* && sudo ln -s ./hosts/<host-name>/configuration.nix /etc/nixos/configuration.nix
```
> Since `configuration.nix` imports your `hardware-configuration.nix` at the top of the file, there is no need to symlink `hardware-configuration.nix` too.

Adjust the `./nixos/modules/user.nix` by replacing everything inside the `<>` with your username:
```nix
{
  programs.zsh.enable = true;

  users.users.<username> = {
    isNormalUser = true;
    description = "<username>";
    extraGroups = [ "audio" "networkmanager" "wheel" ];
...
```

Finally, replace `<username>` in the following piece of code from `./nixos/modules/virtualisation.nix` with your username:
```nix
...
  users.extraGroups.vboxusers.members = [ "<username>" ];
...
```

Rebuild your system.
```bash
sudo nix-channel --update && sudo nixos-rebuild switch
```

## Home-Manager Configuration
***
Create `nixpkgs` directory in `~/.config` (if it is not present already).
```bash
mkdir -p ~/.config/nixpkgs
```
> If it exists, recursively remove its contents with `rm -r ~/.config/nixpkgs/*`.

Create a symlink from `/home/$USER/nix-config/home-manager/home.nix` to `/home/$USER/.config/nixpkgs/home.nix`
```bash
sudo ln -s /home/$USER/nix-config/home-manager/home.nix /home/$USER/.config/nixpkgs/home.nix
```

Replace all the occurrences of `<username>` in `./home-manager/home.nix` with your username.
```nix
...
home = {
  username = "<username>";
  homeDirectory = "/home/<username>";
  stateVersion = "25.05";
}
...
```

Adjust the `./home-manager/modules/git.nix` by replacing everything inside `<>` with the appropriate information:
```nix
{
  programs.git = {
    enable = true;
    userName = "<username>";
    userEmail = "<email>";
    extraConfig = {
      # "master" by default. You can skip this step and keep it "main" like I do
      init.defaultBranch = "<default-branch-name>";
    };
  };
}
```

Switch to your new home-manager configuration with
```bash
sudo nix-channel --update && home-manager switch
```

Congratulations! Now you're done!
